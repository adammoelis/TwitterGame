<% @active_tab = "custom" %>
<% if current_account %>

    <% if current_account.users.size >=2 %>
        <div class="title">
          <h1 class="title_text">Who Tweeted It?</h1>
        </div>

        <br>
        <% @users = current_account.users %>
        <% @user = @users.sample %>
        <% @user.name %>
        <br>

        <% if @game.attempts < Game.max_games %>
          <div class="tweet">
            <h2 class="tweet_text"><%= @user.tweets.sample.text %></h2>
          </div>
        <% end %>


        <%= form_tag("/game", method: "patch") do |f| %>
        <div class="row"
          <div class="scoreboard">
            <div class="col-md-3">
              <p class="label_for_scoreboard">Score</p>
              <input class="score" type="text" name="score" value="<%= @game.score %>" readonly>
            </div>

            <div class="col-md-3">
              <p class="label_for_scoreboard">Attempts</p>
              <input class="score" type="text" name="attempts" value="<%= @game.attempts %>" readonly>
            </div>

            <div class="col-md-3">
            <p class="label_for_scoreboard">Percentage</p>
              <input class="score" type="text" name="percentage" value="<%= @game.display_percentage %>" readonly>

            </div>

                <div class="col-md-3">
                <p class="label_for_scoreboard">Feedback</p>
                <input class="score <%= @game.feedback_class_type %>" type="text"  value="<%= @game.feedback_value %>" readonly>
              </div>


          </div>
        </div>

        <br>
        <br>
        <% if @game.attempts < Game.max_games %>
          <div class="all_buttons">
            <% @users.all.each do |user| %>
            <div id="name_button" class="<%= user.slug %>">
              <input type="submit" class="myButton" name="name" value="<%= user.name %>">
            </div>
            <% end %>

          </div>
          <br>
          <input type="hidden" name="user_id" value="<%= @user.id %>">
      <% end %>
    <% end %>

        <% if @game.display_after_answer %>
        <div class="answer_status_box">
          <p class="answer_status"> <%= @game.display_after_answer %></p>
        </div>
          <% if @game.attempts >= Game.max_games %>
            <div class="container play-again">
              <p class="answer_status" style="font-size: 50px;"><%= "You got #{@game.score}/#{@game.attempts} correct! #{@game.feedback_value}" %></p>
              <br>
              <a href="/game"><button>Play Again!</button></a>
              <br>
              <br>
              <p>Share your game with friends!</p>
              <a href="https://twitter.com/share" data-text="<%= "I got #{@game.display_percentage} using #{@users.map{|user| user.name}.to_sentence}. How many can you guess? #WhoTweetedIt"%>" title="Share on Twitter" target="_blank" class="btn btn-twitter twitter-share-button"><i class="fa fa-twitter"></i> Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
              <a href="https://www.facebook.com/sharer/sharer.php?u=" title="Share on Facebook" target="_blank" class="btn btn-facebook"><i class="fa fa-facebook"></i> Facebook</a>
            </div>
          <% end %>
      <% end %>

      <div class="container" style="margin-bottom:200px; margin-top:100px;">


      <%= form_tag("/game", method: "post") do %>
      <%= label_tag(:username, "Add a username", id: "add-username") %>
      <%= text_field_tag(:username) %>
      <%= submit_tag("Submit", id: "add-username-submit") %>
      <% end %>

      <%= form_tag("/game", method: "delete") do %>
      <%= label_tag(:name, "Remove a username", id: "remove-username") %>
      <%= collection_select(:user, :name, @users, :name, :name) %>
      <%= submit_tag("Remove", id: "remove-username-submit") %>
      <% end %>
      <% if flash[:notice] %>
        <div class="alert alert-danger">
            <%= flash[:notice] %>
        </div>
        <% end %>
        </div>



    <% else %>
      <% if current_account.users.size == 1 %>
        <h2>To get started, you'll need to enter one more Twitter handle</h2>
        <%= form_tag("/game", method: "post") do %>
        <%= label_tag(:username, "Enter 2nd Twitter handle") %>
        <%= text_field_tag(:username, params[:username], id: "add-username-2") %>
        <%= submit_tag("Submit") %>
        <% end %>
        <%= form_tag("/game", method: "delete") do %>
        <%= label_tag(:name, "Remove from game") %>
        <%= collection_select(:user, :name, current_account.users, :name, :name,{}, {id: 'remove-username-2'}) %>
        <%= submit_tag("Remove") %>
        <% end %>
      <% else %>
        <h2>To get started, you'll need to enter two Twitter handles</h2>
        <%= form_tag("/game", method: "post") do %>
        <%= label_tag(:username, "Enter 1st handle") %>
        <%= text_field_tag(:username, params[:username], id: "add-username-2") %>
        <%= submit_tag("Submit") %>
        <% end %>
      <% end %>


      <% if flash[:notice] %>
        <div class="alert alert-danger">
            <%= flash[:notice] %>
        </div>
        <% end %>

    <% end %>


<% else %>

  Uh oh! It appears you aren't signed in! Please login above or return to the home game

<% end %>
